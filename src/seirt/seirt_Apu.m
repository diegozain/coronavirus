function Apu = seirt_Apu(u,p,t,nP,it)
% -----------------------------------------------------------------------------
% diego domenzain
% spring 2020 while at Colorado School of Mines
% ------------------------------------------------------------------------------
% inversion of the SEIR model using the adjoint method.
% this function computes the derivative of A wrt p times u.
% ------------------------------------------------------------------------------
% b = p(1);              % infection rate
% a = p(2);              % protection rate 
% g = p(3);              % inverse of average latent time
% d = p(4);              % inverse of average quarantine time
l1= p(5);                % cure rate
l2= p(6);                % cure rate
k1= p(7);                % mortality
k2= p(8);                % mortality 
% 
% l = l1 * (1-exp(-l2*t(it))); % cure rate
% k = k1 * ( exp(-k2*t(it)) ); % mortality
% ------------------------------------------------------------------------------
Apu      = zeros(7,8);
% ------------------------------------------------------------------------------
Apu(1,1) = -(u(it,3)/nP)*u(it,1);
Apu(2,1) =  (u(it,3)/nP)*u(it,1);
% ------------------------------------------------------------------------------
Apu(1,2) =  -u(it,1);
Apu(7,2) =   u(it,1);
% ------------------------------------------------------------------------------
Apu(2,3) =  -u(it,2);
Apu(3,3) =   u(it,2);
% ------------------------------------------------------------------------------
Apu(3,4) =  -u(it,3);
Apu(4,4) =   u(it,3);
% ------------------------------------------------------------------------------
Apu(4,5) =  -( 1-exp(-l2*t(it)) )*u(it,4);
Apu(5,5) =   ( 1-exp(-l2*t(it)) )*u(it,4);
% ------------------------------------------------------------------------------
Apu(4,6) =  -( l1*t(it)*exp(-l2*t(it)) )*u(it,4);
Apu(5,6) =   ( l1*t(it)*exp(-l2*t(it)) )*u(it,4);
% ------------------------------------------------------------------------------
Apu(4,7) =  -( exp(-k2*t(it)) )*u(it,4);
Apu(6,7) =   ( exp(-k2*t(it)) )*u(it,4);
% ------------------------------------------------------------------------------
Apu(4,8) =   (  k1*t(it)*exp(-k2*t(it)) )*u(it,4);
Apu(6,8) =  -(  k1*t(it)*exp(-k2*t(it)) )*u(it,4);
% ------------------------------------------------------------------------------
end